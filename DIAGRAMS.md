# Diagramas e Fluxogramas - Tron Game

**Documento:** RepresentaÃ§Ãµes Visuais da Arquitetura e Fluxos  
**Projeto:** Tron Game - Multiplayer DistribuÃ­do  
**Autor:** JoÃ£o Costa  
**Data:** Dezembro de 2024

---

## ğŸ“‹ SumÃ¡rio

1. [Arquitetura do Sistema](#arquitetura-do-sistema)
2. [Fluxos de ComunicaÃ§Ã£o](#fluxos-de-comunicaÃ§Ã£o)
3. [MÃ¡quinas de Estado](#mÃ¡quinas-de-estado)
4. [Diagramas de SequÃªncia](#diagramas-de-sequÃªncia)
5. [Estruturas de Dados](#estruturas-de-dados)

---

## ğŸ—ï¸ Arquitetura do Sistema

### VisÃ£o Geral - Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SISTEMA TRON GAME                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE 1      â”‚                              â”‚   CLIENTE 2      â”‚
â”‚  (Player 0)      â”‚                              â”‚  (Player 1)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                              â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Pyxel     â”‚  â”‚                              â”‚  â”‚  Pyxel     â”‚  â”‚
â”‚  â”‚  Renderer  â”‚  â”‚                              â”‚  â”‚  Renderer  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â†•         â”‚                              â”‚        â†•         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   App      â”‚  â”‚                              â”‚  â”‚   App      â”‚  â”‚
â”‚  â”‚  (Logic)   â”‚  â”‚                              â”‚  â”‚  (Logic)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â†•         â”‚                              â”‚        â†•         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        TCP Socket            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚GameClient  â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚GameClient  â”‚  â”‚
â”‚  â”‚ (Network)  â”‚  â”‚     (Input/State)            â”‚  â”‚ (Network)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                  â”‚
         â”‚                    TCP/IP                        â”‚
         â”‚              Port 5555 (JSON)                    â”‚
         â”‚                                                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SERVIDOR         â”‚
                    â”‚  (Autoridade)      â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                    â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚  GameServer    â”‚ â”‚
                    â”‚ â”‚   (main loop)  â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚         â†•          â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚  Game State    â”‚ â”‚
                    â”‚ â”‚  - Players     â”‚ â”‚
                    â”‚ â”‚  - Scores      â”‚ â”‚
                    â”‚ â”‚  - Trails      â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚         â†•          â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚  Game Logic    â”‚ â”‚
                    â”‚ â”‚  - Movement    â”‚ â”‚
                    â”‚ â”‚  - Collision   â”‚ â”‚
                    â”‚ â”‚  - Scoring     â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚         â†•          â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚   TCP Server   â”‚ â”‚
                    â”‚ â”‚   (Sockets)    â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Camadas da AplicaÃ§Ã£o Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAMADA DE APRESENTAÃ‡ÃƒO                    â”‚
â”‚  (Pyxel Renderer - 60 FPS)                          â”‚
â”‚                                                      â”‚
â”‚  â€¢ Desenha rastros                                  â”‚
â”‚  â€¢ Desenha jogadores                                â”‚
â”‚  â€¢ Exibe placar                                     â”‚
â”‚  â€¢ Mensagens de UI                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAMADA DE LÃ“GICA DE CLIENTE              â”‚
â”‚  (App.update() - Loop Principal)                    â”‚
â”‚                                                      â”‚
â”‚  â€¢ Captura input (teclado)                          â”‚
â”‚  â€¢ Processa fila de estados                         â”‚
â”‚  â€¢ Atualiza histÃ³rico local                         â”‚
â”‚  â€¢ Detecta transiÃ§Ãµes (morte/reset)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAMADA DE REDE                           â”‚
â”‚  (GameClient - Thread Separada)                     â”‚
â”‚                                                      â”‚
â”‚  â€¢ Estabelece conexÃ£o TCP                           â”‚
â”‚  â€¢ Envia comandos (UP/DOWN/LEFT/RIGHT/RESET)        â”‚
â”‚  â€¢ Recebe estados (JSON)                            â”‚
â”‚  â€¢ Buffer de fragmentaÃ§Ã£o                           â”‚
â”‚  â€¢ Fila FIFO de estados                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAMADA DE TRANSPORTE (TCP)                  â”‚
â”‚                                                      â”‚
â”‚  â€¢ Confiabilidade (ACK/RetransmissÃ£o)               â”‚
â”‚  â€¢ OrdenaÃ§Ã£o (Sequence Numbers)                     â”‚
â”‚  â€¢ Controle de Fluxo (Window)                       â”‚
â”‚  â€¢ Controle de Congestionamento                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Camadas da AplicaÃ§Ã£o Servidor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAMADA DE GERENCIAMENTO DE JOGO             â”‚
â”‚  (GameServer - Autoridade Central)                  â”‚
â”‚                                                      â”‚
â”‚  â€¢ Aceita conexÃµes (mÃ¡x 2 clientes)                â”‚
â”‚  â€¢ Atribui IDs aos jogadores                        â”‚
â”‚  â€¢ Gerencia estado global                           â”‚
â”‚  â€¢ Coordena threads                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAMADA DE LÃ“GICA DE JOGO                 â”‚
â”‚  (process_turn() - 30 FPS)                          â”‚
â”‚                                                      â”‚
â”‚  1. Atualiza direÃ§Ãµes (valida inputs)              â”‚
â”‚  2. Move jogadores (2 pixels/frame)                 â”‚
â”‚  3. Detecta colisÃµes                                â”‚
â”‚     â€¢ Bordas (x=0, x=256, y=0, y=256)              â”‚
â”‚     â€¢ Rastros (prÃ³prio e adversÃ¡rio)               â”‚
â”‚     â€¢ ColisÃ£o frontal (empate)                     â”‚
â”‚  4. Atualiza placar                                 â”‚
â”‚  5. Adiciona rastros                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAMADA DE SINCRONIZAÃ‡ÃƒO                     â”‚
â”‚  (send_state() - 30 Hz)                             â”‚
â”‚                                                      â”‚
â”‚  â€¢ Serializa estado em JSON                         â”‚
â”‚  â€¢ Broadcast para todos os clientes                 â”‚
â”‚  â€¢ Adiciona delimitador '\n'                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       CAMADA DE COMUNICAÃ‡ÃƒO (Threads)               â”‚
â”‚                                                      â”‚
â”‚  Thread Principal: game_loop()                      â”‚
â”‚  â””â”€ Processa turnos a 30 FPS                        â”‚
â”‚                                                      â”‚
â”‚  Thread por Cliente: handle_client_input()          â”‚
â”‚  â””â”€ Escuta comandos assincronamente                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAMADA DE TRANSPORTE (TCP)                  â”‚
â”‚                                                      â”‚
â”‚  â€¢ Aceita conexÃµes (listen/accept)                  â”‚
â”‚  â€¢ Envia/recebe bytes                               â”‚
â”‚  â€¢ Gerencia sockets                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxos de ComunicaÃ§Ã£o

### Fluxo 1: Estabelecimento de ConexÃ£o

```
Cliente                               Servidor
  â”‚                                      â”‚
  â”‚                                      â”‚ socket.socket()
  â”‚                                      â”‚ bind(('0.0.0.0', 5555))
  â”‚                                      â”‚ listen(2)
  â”‚                                      â”‚ [Aguardando...]
  â”‚                                      â”‚
  â”‚ socket.socket()                      â”‚
  â”‚ connect(('IP', 5555))                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[SYN]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                      â”‚ accept() retorna
  â”‚                                      â”‚ conn, addr = ...
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[SYN-ACK]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ACK]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                      â”‚
  â”‚           [ConexÃ£o Estabelecida]     â”‚
  â”‚                                      â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"0\n"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ conn.send(f"{pid}\n")
  â”‚                                      â”‚
  â”‚ self.my_id = 0                       â”‚ threading.Thread(
  â”‚                                      â”‚   target=handle_client_input,
  â”‚                                      â”‚   args=(0, conn)
  â”‚                                      â”‚ ).start()
  â”‚                                      â”‚
  â”‚ threading.Thread(                    â”‚
  â”‚   target=listen_server               â”‚
  â”‚ ).start()                            â”‚
  â”‚                                      â”‚
  â”‚         [Threads Ativas]             â”‚
  â”‚                                      â”‚
  â”‚  â€¢ listen_server()                   â”‚  â€¢ handle_client_input(0, conn)
  â”‚    â””â”€ Escuta estados                 â”‚    â””â”€ Escuta comandos
  â”‚                                      â”‚  â€¢ game_loop()
  â”‚                                      â”‚    â””â”€ Processa jogo (30 FPS)
  â”‚                                      â”‚
```

---

### Fluxo 2: Envio de Input (Cliente â†’ Servidor)

```
Cliente                               Servidor
  â”‚                                      â”‚
  â”‚ [Jogador pressiona â†‘]                â”‚
  â”‚   py.btn(py.KEY_UP) == True          â”‚
  â”‚                                      â”‚
  â”‚ key = 'UP'                           â”‚
  â”‚                                      â”‚
  â”‚ if key != self.last_sent_key:        â”‚
  â”‚   self.net.send_input('UP')          â”‚
  â”‚   self.last_sent_key = 'UP'          â”‚
  â”‚                                      â”‚
  â”‚ def send_input(key):                 â”‚
  â”‚   self.client.sendall(key.encode())  â”‚
  â”‚                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"UP"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                      â”‚ [Thread handle_client_input]
  â”‚                                      â”‚
  â”‚                                      â”‚ data = conn.recv(1024)
  â”‚                                      â”‚ data = "UP"
  â”‚                                      â”‚
  â”‚                                      â”‚ commands = data.split('\n')
  â”‚                                      â”‚ cmd = commands[-1]
  â”‚                                      â”‚
  â”‚                                      â”‚ self.last_inputs[0] = 'UP'
  â”‚                                      â”‚
  â”‚                                      â”‚ [Buffer atualizado, aguarda]
  â”‚                                      â”‚ [prÃ³ximo process_turn()]
  â”‚                                      â”‚
```

---

### Fluxo 3: Processamento e Broadcast de Estado

```
Servidor (game_loop)
     â”‚
     â”‚ [A cada 1/30 segundo = 33ms]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. process_turn()                     â”‚
â”‚                                         â”‚
â”‚  Para cada jogador (0, 1):             â”‚
â”‚  â”œâ”€ inp = last_inputs[pid]             â”‚
â”‚  â”œâ”€ Atualiza direÃ§Ã£o (se vÃ¡lido)       â”‚
â”‚  â”œâ”€ Move (x/y += 2 pixels)             â”‚
â”‚  â”œâ”€ Verifica colisÃµes                  â”‚
â”‚  â””â”€ Adiciona rastro                    â”‚
â”‚                                         â”‚
â”‚  Atualiza placar se houve morte        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. send_state()                       â”‚
â”‚                                         â”‚
â”‚  game_state = {                        â”‚
â”‚    'players': {...},                   â”‚
â”‚    'score': {...},                     â”‚
â”‚    'match_winner': ...                 â”‚
â”‚  }                                     â”‚
â”‚                                         â”‚
â”‚  state_json = json.dumps(game_state)   â”‚
â”‚  state_msg = state_json + "\n"         â”‚
â”‚                                         â”‚
â”‚  Para cada cliente conectado:          â”‚
â”‚  â””â”€ conn.sendall(state_msg.encode())   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                      â”‚
                 â–¼                      â–¼
            Cliente 0              Cliente 1
                 â”‚                      â”‚
      [Thread listen_server]  [Thread listen_server]
                 â”‚                      â”‚
         data = recv(4096)      data = recv(4096)
         buffer += data         buffer += data
                 â”‚                      â”‚
      while "\n" in buffer:  while "\n" in buffer:
        line, buffer = ...     line, buffer = ...
        state = json.loads()   state = json.loads()
        queue.append(state)    queue.append(state)
                 â”‚                      â”‚
```

---

### Fluxo 4: Processamento de Estado no Cliente

```
Cliente (Thread Principal - Pyxel)
     â”‚
     â”‚ [A cada frame - 60 FPS]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  update()                              â”‚
â”‚                                         â”‚
â”‚  1. Captura Input                      â”‚
â”‚  â”œâ”€ Se tecla pressionada               â”‚
â”‚  â””â”€ Envia para servidor                â”‚
â”‚                                         â”‚
â”‚  2. Processa Fila de Estados           â”‚
â”‚  â””â”€ while state_queue:                 â”‚
â”‚      â”œâ”€ state = queue.pop(0)  [FIFO]  â”‚
â”‚      â”‚                                  â”‚
â”‚      â”œâ”€ Detecta Reset                  â”‚
â”‚      â”‚  (dead: true â†’ false)           â”‚
â”‚      â”‚                                  â”‚
â”‚      â”œâ”€ Atualiza PosiÃ§Ãµes              â”‚
â”‚      â”‚  players_local[pid]['x/y']      â”‚
â”‚      â”‚                                  â”‚
â”‚      â”œâ”€ Adiciona Rastros               â”‚
â”‚      â”‚  extend(state['rastro'])        â”‚
â”‚      â”‚                                  â”‚
â”‚      â””â”€ Atualiza Placar                â”‚
â”‚         score, match_winner            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  draw()                                â”‚
â”‚                                         â”‚
â”‚  1. Limpa tela: py.cls(0)              â”‚
â”‚                                         â”‚
â”‚  2. Se aguardando:                     â”‚
â”‚     â””â”€ Exibe "Esperando oponente..."   â”‚
â”‚                                         â”‚
â”‚  3. SenÃ£o:                             â”‚
â”‚     â”œâ”€ Desenha placar                  â”‚
â”‚     â”œâ”€ Para cada jogador:              â”‚
â”‚     â”‚  â”œâ”€ Desenha rastros              â”‚
â”‚     â”‚  â”‚  (cada ponto = 2Ã—2 pixels)    â”‚
â”‚     â”‚  â””â”€ Desenha cabeÃ§a               â”‚
â”‚     â”‚                                   â”‚
â”‚     â”œâ”€ Se alguÃ©m morreu:               â”‚
â”‚     â”‚  â””â”€ Exibe mensagem               â”‚
â”‚     â”‚     ("Fim da rodada" ou          â”‚
â”‚     â”‚      "PLAYER X VENCEU")          â”‚
â”‚     â”‚                                   â”‚
â”‚     â””â”€ Se aguardando reset:            â”‚
â”‚        â””â”€ Exibe instruÃ§Ã£o              â”‚
â”‚           ("ESPACO para reiniciar")    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ MÃ¡quinas de Estado

### Estado do Servidor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MÃQUINA DE ESTADOS - SERVIDOR                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  INITIALIZING   â”‚  
         â”‚                 â”‚  
         â”‚ â€¢ server.bind() â”‚
         â”‚ â€¢ server.listen â”‚
         â”‚ â€¢ Start threads â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ len(conns) == 2
                  â”‚ (2 clientes conectados)
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ WAITING_START   â”‚
         â”‚                 â”‚
         â”‚ â€¢ print("3s")   â”‚
         â”‚ â€¢ sleep(3)      â”‚
         â”‚ â€¢ started=True  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Countdown finalizado
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    ROUND_ACTIVE        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        â”‚                   â”‚
    â”‚ Loop (30 FPS):         â”‚                   â”‚
    â”‚ â€¢ process_turn()       â”‚                   â”‚
    â”‚ â€¢ send_state()         â”‚                   â”‚
    â”‚ â€¢ sleep(TICK_RATE)     â”‚                   â”‚
    â”‚                        â”‚                   â”‚
    â”‚ CondiÃ§Ãµes:             â”‚                   â”‚
    â”‚ â€¢ dead[0] == False     â”‚                   â”‚
    â”‚ â€¢ dead[1] == False     â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
             â”‚                                    â”‚
             â”‚ Algum jogador morreu               â”‚
             â”‚ (dead[0] ou dead[1] == True)       â”‚
             â”‚                                    â”‚
             â–¼                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
    â”‚    ROUND_ENDED         â”‚                   â”‚
    â”‚                        â”‚                   â”‚
    â”‚ â€¢ Continua enviando    â”‚                   â”‚
    â”‚   estados (dead=True)  â”‚                   â”‚
    â”‚ â€¢ Aguarda RESET de     â”‚                   â”‚
    â”‚   ambos jogadores      â”‚                   â”‚
    â”‚                        â”‚                   â”‚
    â”‚ CondiÃ§Ã£o:              â”‚                   â”‚
    â”‚ â€¢ reset_req[0]==True   â”‚                   â”‚
    â”‚ â€¢ reset_req[1]==True   â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
             â”‚                                    â”‚
             â”œâ”€â”€â–º Se score < 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚    (Rodada normal)                 â”‚
             â”‚    reset_game(full=False)          â”‚
             â”‚                                    â”‚
             â””â”€â”€â–º Se score >= 2                   â”‚
                  (VitÃ³ria na partida)            â”‚
                  â”‚                               â”‚
                  â–¼                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
         â”‚  MATCH_ENDED    â”‚                     â”‚
         â”‚                 â”‚                     â”‚
         â”‚ â€¢ winner != nullâ”‚                     â”‚
         â”‚ â€¢ Aguarda RESET â”‚                     â”‚
         â”‚   de ambos      â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                  â”‚                               â”‚
                  â”‚ Ambos enviaram RESET          â”‚
                  â”‚ reset_game(full=True)         â”‚
                  â”‚ (Zera placar)                 â”‚
                  â”‚                               â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Estado do Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MÃQUINA DE ESTADOS - CLIENTE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   CONNECTING    â”‚
         â”‚                 â”‚
         â”‚ â€¢ socket.connectâ”‚
         â”‚ â€¢ Aguarda ID    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Recebe player_id
                  â”‚ (0 ou 1)
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  WAITING_GAME   â”‚
         â”‚                 â”‚
         â”‚ â€¢ Exibe msg:    â”‚
         â”‚   "Esperando    â”‚
         â”‚    Oponente..." â”‚
         â”‚ â€¢ state_queue   â”‚
         â”‚   vazia         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Recebe primeiro estado
                  â”‚ com ambos jogadores
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       PLAYING            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          â”‚                   â”‚
    â”‚ â€¢ Captura inputs         â”‚                   â”‚
    â”‚ â€¢ Processa state_queue   â”‚                   â”‚
    â”‚ â€¢ Renderiza jogo         â”‚                   â”‚
    â”‚                          â”‚                   â”‚
    â”‚ CondiÃ§Ã£o:                â”‚                   â”‚
    â”‚ â€¢ dead[my_id] == False   â”‚                   â”‚
    â”‚   OU                     â”‚                   â”‚
    â”‚ â€¢ dead[oponente] == Falseâ”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
               â”‚                                    â”‚
               â”‚ Recebe estado com                  â”‚
               â”‚ dead == True                       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
    â”‚     ROUND_OVER           â”‚                   â”‚
    â”‚                          â”‚                   â”‚
    â”‚ Se match_winner == null: â”‚                   â”‚
    â”‚ â”œâ”€ Exibe "Fim da rodada" â”‚                   â”‚
    â”‚ â””â”€ "ESPACO para prÃ³xima" â”‚                   â”‚
    â”‚                          â”‚                   â”‚
    â”‚ Se match_winner != null: â”‚                   â”‚
    â”‚ â”œâ”€ Exibe "PLAYER X VENC" â”‚                   â”‚
    â”‚ â””â”€ "ESPACO nova partida" â”‚                   â”‚
    â”‚                          â”‚                   â”‚
    â”‚ Ao pressionar ESPAÃ‡O:    â”‚                   â”‚
    â”‚ â””â”€ Envia "RESET"         â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
               â”‚                                    â”‚
               â”‚ Recebe estado com                  â”‚
               â”‚ dead == False                      â”‚
               â”‚ (Reset detectado)                  â”‚
               â”‚                                    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Diagramas de SequÃªncia Detalhados

### SequÃªncia Completa: Da ConexÃ£o ao Fim de Partida

```
Cliente 0              Servidor              Cliente 1
    â”‚                      â”‚                      â”‚
    â”‚â”€â”€TCP Connectâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€â”€â”€â”€â”€"0\n"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚  [Sou Player 0]      â”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚â—„â”€â”€TCP Connectâ”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚â”€â”€â”€â”€â”€â”€"1\n"â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚      [Sou Player 1]  â”‚
    â”‚                      â”‚                      â”‚
    â”‚     [Servidor detecta 2 clientes]          â”‚
    â”‚                      â”‚                      â”‚
    â”‚        print("Jogo comeÃ§ando em 3s...")    â”‚
    â”‚                      â”‚                      â”‚
    â”‚             [Sleep 3 segundos]             â”‚
    â”‚                      â”‚                      â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RODADA 1 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATE(frame:1)â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATE(frame:1)â”€â”€â”€â”€â–ºâ”‚
    â”‚  P0: x=20, y=100     â”‚  P0: x=20, y=100    â”‚
    â”‚  P1: x=230, y=100    â”‚  P1: x=230, y=100   â”‚
    â”‚  dead: F, F          â”‚  dead: F, F         â”‚
    â”‚  score: 0-0          â”‚  score: 0-0         â”‚
    â”‚                      â”‚                      â”‚
    â”‚â”€â”€â”€"RIGHT"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚â—„â”€â”€â”€â”€"LEFT"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATE(frame:2)â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATE(frame:2)â”€â”€â”€â”€â–ºâ”‚
    â”‚  P0: x=22, y=100     â”‚  P0: x=22, y=100    â”‚
    â”‚  P1: x=228, y=100    â”‚  P1: x=228, y=100   â”‚
    â”‚                      â”‚                      â”‚
    â”‚    [Jogo continua... ~5 segundos]          â”‚
    â”‚                      â”‚                      â”‚
    â”‚â”€â”€â”€"UP"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚  [P0 colide borda]  â”‚
    â”‚                      â”‚  [P0.dead = True]   â”‚
    â”‚                      â”‚  [score[1]++]       â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATE(frame:150)â”€â”€â”€â”€â”¤â”€â”€STATE(frame:150)â”€â”€â–ºâ”‚
    â”‚  P0: dead=True       â”‚  P0: dead=True      â”‚
    â”‚  P1: dead=False      â”‚  P1: dead=False     â”‚
    â”‚  score: 0-1          â”‚  score: 0-1         â”‚
    â”‚                      â”‚                      â”‚
    â”‚ [Exibe: Fim!]        â”‚        [Exibe: Fim!]â”‚
    â”‚ [Pressiona ESPAÃ‡O]   â”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚â”€â”€â”€"RESET"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚ [Aguardando...]      â”‚                      â”‚
    â”‚                      â”‚                      â”‚
    â”‚                      â”‚      [Pressiona SPC] â”‚
    â”‚                      â”‚â—„â”€â”€â”€â”€"RESET"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                      â”‚                      â”‚
    â”‚           [Servidor reseta jogo]           â”‚
    â”‚           [full_reset = False]             â”‚
    â”‚           [MantÃ©m score: 0-1]              â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATE(reset)â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATE(reset)â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚  P0: x=20, y=100     â”‚  P0: x=20, y=100    â”‚
    â”‚  P1: x=230, y=100    â”‚  P1: x=230, y=100   â”‚
    â”‚  dead: F, F          â”‚  dead: F, F         â”‚
    â”‚  score: 0-1          â”‚  score: 0-1         â”‚
    â”‚  rastros: []         â”‚  rastros: []        â”‚
    â”‚                      â”‚                      â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RODADA 2 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
    â”‚                      â”‚                      â”‚
    â”‚    [P1 colide apÃ³s 3 segundos]             â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚  score: 1-1          â”‚  score: 1-1         â”‚
    â”‚                      â”‚                      â”‚
    â”‚    [Ambos resetam...]                      â”‚
    â”‚                      â”‚                      â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RODADA 3 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
    â”‚                      â”‚                      â”‚
    â”‚    [P1 colide novamente apÃ³s 4s]           â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚  score: 2-1          â”‚  score: 2-1         â”‚
    â”‚  winner: 0           â”‚  winner: 0          â”‚
    â”‚                      â”‚                      â”‚
    â”‚ [PLAYER 0 VENCEU!]   â”‚   [PLAYER 0 VENCEU!]â”‚
    â”‚                      â”‚                      â”‚
    â”‚â”€â”€â”€"RESET"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
    â”‚                      â”‚â—„â”€â”€â”€â”€"RESET"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                      â”‚                      â”‚
    â”‚      [full_reset = True, zera placar]      â”‚
    â”‚                      â”‚                      â”‚
    â”‚â—„â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€STATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚  score: 0-0          â”‚  score: 0-0         â”‚
    â”‚  winner: null        â”‚  winner: null       â”‚
    â”‚                      â”‚                      â”‚
```

---

### Detalhamento: FragmentaÃ§Ã£o e Buffering de TCP

```
Servidor                        Rede TCP                      Cliente
    â”‚                              â”‚                             â”‚
    â”‚  state = json.dumps({...})   â”‚                             â”‚
    â”‚  state += "\n"               â”‚                             â”‚
    â”‚  conn.sendall(state)         â”‚                             â”‚
    â”‚                              â”‚                             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[200 bytes]â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                             â”‚
    â”‚                              â”‚                             â”‚
    â”‚         [TCP fragmenta]      â”‚                             â”‚
    â”‚                              â”‚                             â”‚
    â”‚                              â”œâ”€â”€â”€â”€[100 bytes]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                              â”‚                             â”‚
    â”‚                              â”‚    buffer += data           â”‚
    â”‚                              â”‚    buffer = "{"players":{...â”‚
    â”‚                              â”‚    [Sem '\n' ainda]         â”‚
    â”‚                              â”‚                             â”‚
    â”‚                              â”œâ”€â”€â”€â”€[100 bytes]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                              â”‚                             â”‚
    â”‚                              â”‚    buffer += data           â”‚
    â”‚                              â”‚    buffer = "...}}\n"       â”‚
    â”‚                              â”‚                             â”‚
    â”‚                              â”‚    [Detecta '\n']           â”‚
    â”‚                              â”‚    line, buffer = split()   â”‚
    â”‚                              â”‚    state = json.loads(line) â”‚
    â”‚                              â”‚    queue.append(state) âœ…   â”‚
    â”‚                              â”‚                             â”‚
```

---

## ğŸ“¦ Estruturas de Dados

### Estrutura de Estado do Servidor

```python
# DicionÃ¡rio principal mantido pelo servidor
server_state = {
    'players': {
        0: {
            'x': 20,                    # int: Coordenada X (0-256)
            'y': 100,                   # int: Coordenada Y (0-256)
            'dir': '2',                 # str: '0'=UP, '1'=LEFT, '2'=RIGHT, '3'=DOWN
            'dead': False,              # bool: Status de vida
            'rastro': [[20, 100]],      # list: Ãšltimo ponto (enviado ao cliente)
            'rastro_completo': [        # list: HistÃ³rico completo (colisÃµes)
                [20, 100],
                [22, 100],
                [24, 100],
                # ... milhares de pontos
            ]
        },
        1: {
            'x': 230,
            'y': 100,
            'dir': '1',
            'dead': False,
            'rastro': [[230, 100]],
            'rastro_completo': [
                [230, 100],
                [228, 100],
                # ...
            ]
        }
    },
    
    'score': {
        0: 1,  # int: Rodadas ganhas pelo Player 0
        1: 0   # int: Rodadas ganhas pelo Player 1
    },
    
    'match_winner': None,  # int ou None: ID do vencedor (None = em andamento)
    
    'last_inputs': {
        0: 'RIGHT',  # str ou None: Ãšltimo comando recebido
        1: 'LEFT'
    },
    
    'reset_requests': {
        0: False,  # bool: Player 0 pediu reset?
        1: False   # bool: Player 1 pediu reset?
    },
    
    'conns': {
        0: <socket.socket>,  # Socket TCP do Player 0
        1: <socket.socket>   # Socket TCP do Player 1
    },
    
    'game_started': True  # bool: Countdown finalizado?
}
```

---

### Estrutura de Estado do Cliente

```python
# Estado local mantido pelo cliente
client_state = {
    'my_id': 0,  # int: ID atribuÃ­do pelo servidor (0 ou 1)
    
    'net': {
        'client_socket': <socket.socket>,  # Socket TCP
        'buffer': "",                      # str: Buffer de fragmentaÃ§Ã£o
        'state_queue': [                   # list: Fila FIFO de estados
            {'players': {...}, 'score': {...}, ...},
            {'players': {...}, 'score': {...}, ...},
        ]
    },
    
    'players_local_data': {
        0: {
            'x': 22,                # int: PosiÃ§Ã£o atual
            'y': 100,
            'dead': False,          # bool: Status
            'rastro': [             # list: HistÃ³rico completo LOCAL
                [20, 100],
                [22, 100],
                [24, 100],
                # ... acumulado de todos os estados recebidos
            ]
        },
        1: {
            'x': 228,
            'y': 100,
            'dead': False,
            'rastro': [
                [230, 100],
                [228, 100],
                # ...
            ]
        }
    },
    
    'score': {
        0: 1,
        1: 0
    },
    
    'match_winner': None,
    
    'last_sent_key': 'RIGHT',  # str ou None: Evita reenvio
    'waiting_reset': False     # bool: JÃ¡ enviei RESET?
}
```

---

### Fluxo de Dados: Rastro

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GERENCIAMENTO DE RASTROS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SERVIDOR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1:
  â€¢ Player move: x=20, y=100
  â€¢ rastro_completo.append([20, 100])
  â€¢ rastro = [[20, 100]]  â† Envia apenas este

Frame 2:
  â€¢ Player move: x=22, y=100
  â€¢ rastro_completo.append([22, 100])  â† Agora tem 2 pontos
  â€¢ rastro = [[22, 100]]  â† Envia apenas este (novo)

Frame 3:
  â€¢ Player move: x=24, y=100
  â€¢ rastro_completo.append([24, 100])  â† Agora tem 3 pontos
  â€¢ rastro = [[24, 100]]  â† Envia apenas este (novo)

rastro_completo usado para:
  âœ“ DetecÃ§Ã£o de colisÃ£o (todos os pontos)

rastro usado para:
  âœ“ Envio ao cliente (economiza banda)


CLIENTE:
â”€â”€â”€â”€â”€â”€â”€â”€
Recebe Frame 1:
  â€¢ state['rastro'] = [[20, 100]]
  â€¢ players_local['rastro'].extend([[20, 100]])
  â€¢ HistÃ³rico local: [[20, 100]]

Recebe Frame 2:
  â€¢ state['rastro'] = [[22, 100]]
  â€¢ players_local['rastro'].extend([[22, 100]])
  â€¢ HistÃ³rico local: [[20, 100], [22, 100]]

Recebe Frame 3:
  â€¢ state['rastro'] = [[24, 100]]
  â€¢ players_local['rastro'].extend([[24, 100]])
  â€¢ HistÃ³rico local: [[20, 100], [22, 100], [24, 100]]

RenderizaÃ§Ã£o:
  â€¢ for rastro in players_local['rastro']:
  â€¢   py.rect(rastro[0], rastro[1], 2, 2, color)
  â€¢ Desenha TODOS os pontos acumulados


ECONOMIA DE BANDA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sem otimizaÃ§Ã£o (enviar tudo):
  Frame 1: [20,100]                    â†’ 10 bytes
  Frame 2: [20,100], [22,100]          â†’ 20 bytes
  Frame 3: [20,100], [22,100], [24,100]â†’ 30 bytes
  ...
  Frame 900 (30s): 900 pontos          â†’ 9000 bytes por frame!

Com otimizaÃ§Ã£o (enviar incremento):
  Frame 1: [20,100]   â†’ 10 bytes
  Frame 2: [22,100]   â†’ 10 bytes
  Frame 3: [24,100]   â†’ 10 bytes
  ...
  Frame 900: [X, Y]   â†’ 10 bytes (constante!)

Economia apÃ³s 30 segundos:
  Sem: ~270 KB
  Com: ~9 KB
  ReduÃ§Ã£o: 96.7% ğŸ‰
```

---

### VisualizaÃ§Ã£o: ColisÃ£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SISTEMA DE DETECÃ‡ÃƒO DE COLISÃƒO                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Arena (256Ã—256 pixels):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                      â”‚
â”‚         â–ˆ                                                      â”‚
â”‚         â–ˆ              CENÃRIO DE COLISÃƒO:                     â”‚
â”‚         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                             â”‚
â”‚                  â–ˆ     1. Player move para x=24, y=100         â”‚
â”‚                  â–ˆ                                             â”‚
â”‚        ??????????â–ˆ     2. Servidor verifica:                   â”‚
â”‚        ?    P0 â–ºâ”€â–ˆ        â€¢ [24, 100] estÃ¡ em bordas?  âŒ     â”‚
â”‚        ?         â–ˆ        â€¢ [24, 100] estÃ¡ em rastro_P0? âŒ   â”‚
â”‚        ??????????â–ˆ        â€¢ [24, 100] estÃ¡ em rastro_P1? âŒ   â”‚
â”‚                  â–ˆ                                             â”‚
â”‚                  â–ˆ     3. Tudo OK, adiciona rastro             â”‚
â”‚                  â–ˆ                                             â”‚
â”‚                                                                 â”‚
â”‚                           Legenda:                             â”‚
â”‚                           â–ˆâ–ˆâ–ˆ Rastro do Player 0 (azul)        â”‚
â”‚                           ??? Rastro do Player 1 (vermelho)    â”‚
â”‚                           P0  CabeÃ§a do Player 0               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Algoritmo de ColisÃ£o (servidor):

def process_turn():
    # 1. Move todos os jogadores
    for pid in players:
        player['x'] += delta_x[player['dir']]
        player['y'] += delta_y[player['dir']]
    
    # 2. Verifica colisÃµes
    for pid in players:
        pos = [player['x'], player['y']]
        
        # ColisÃ£o com bordas
        if pos[0] <= 0 or pos[0] >= 256:
            player['dead'] = True â˜ ï¸
            
        if pos[1] <= 0 or pos[1] >= 256:
            player['dead'] = True â˜ ï¸
        
        # ColisÃ£o com rastros
        for other_pid in players:
            if pos in players[other_pid]['rastro_completo']:
                player['dead'] = True â˜ ï¸
    
    # 3. ColisÃ£o frontal (ambos na mesma posiÃ§Ã£o)
    if players[0]['x'] == players[1]['x'] and \
       players[0]['y'] == players[1]['y']:
        players[0]['dead'] = True â˜ ï¸
        players[1]['dead'] = True â˜ ï¸
        # Empate!
```

---

## ğŸ¯ Fluxograma: LÃ³gica do Servidor

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Servidor      â”‚
                    â”‚   Iniciado      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Bind & Listen  â”‚
                    â”‚  Port 5555      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Aceita ConexÃ£o Cliente â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ len(conns) < 2â”‚â”€â”€â”€[SIM]â”€â”€â”€â–º Aceita, atribui ID
                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                         â”‚                             â”‚
                        [NÃƒO]                          â”‚
                         â”‚                             â–¼
                         â–¼                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  conn.send(ID)  â”‚
                â”‚ Rejeita Cliente â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                       â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ len(conns)==2 â”‚â”€â”€â”€[NÃƒO]â”€â”€â”€â–º Aguarda...
                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                        [SIM]
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Sleep(3s)      â”‚
                â”‚  Countdown      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        GAME LOOP (30 FPS)          â”‚
        â”‚                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  1. process_turn()           â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ LÃª last_inputs[]    â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                â–¼             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ Atualiza direÃ§Ãµes   â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ (valida movimentos) â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                â–¼             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ Move players        â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ (x/y += 2 pixels)   â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                â–¼             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ Detecta colisÃµes    â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ â€¢ Bordas            â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ â€¢ Rastros           â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ â€¢ Frontal           â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                â–¼             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ AlguÃ©m morreu?      â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚         [SIM]       [NÃƒO]    â”‚  â”‚
        â”‚  â”‚          â”‚           â”‚       â”‚  â”‚
        â”‚  â”‚          â–¼           â–¼       â”‚  â”‚
        â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
        â”‚  â”‚   â”‚Atualiza  â”‚  â”‚Adiciona â”‚ â”‚  â”‚
        â”‚  â”‚   â”‚Placar    â”‚  â”‚Rastro   â”‚ â”‚  â”‚
        â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  2. send_state()             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ json.dumps(state)   â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â”‚                â–¼             â”‚  â”‚
        â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚     â”‚ Para cada cliente   â”‚  â”‚  â”‚
        â”‚  â”‚     â”‚ conn.sendall(state) â”‚  â”‚  â”‚
        â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  3. MantÃ©m 30 FPS            â”‚  â”‚
        â”‚  â”‚     sleep(TICK_RATE)          â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â””â”€â”€â–º Loop Infinito
```

---

## ğŸ“š GlossÃ¡rio Visual

### Conceitos Importantes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GLOSSÃRIO                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TICK_RATE (Taxa de AtualizaÃ§Ã£o):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤
  0   33ms 66ms 99ms ...         1000ms

  â€¢ Servidor processa jogo a 30 Hz (1/30 = 33ms)
  â€¢ A cada 33ms, um novo "frame" Ã© calculado
  â€¢ Estados sÃ£o enviados apÃ³s cada processamento


CLIENTE AUTORITATIVO vs SERVIDOR AUTORITATIVO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Cliente Autoritativo (NÃƒO usado):
  Cliente 1 â”€â”€â–º Calcula colisÃ£o â”€â”€â–º "Morri" â”€â”€â–º Servidor
  [Problema: Cliente pode trapacear! ğŸ®ğŸš«]

Servidor Autoritativo (USADO):
  Cliente 1 â”€â”€â–º Envia input â”€â”€â–º Servidor calcula â”€â”€â–º "VocÃª morreu"
                                      â†“
                                 Todos clientes recebem
  [Vantagem: Servidor Ã© a verdade absoluta âœ…]


HEAD-OF-LINE BLOCKING (TCP):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Pacote 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Entregue âœ…
  Pacote 2 â”€â”€â”€Xâ”€â”€â”€â”€â”€â”€â–º Perdido âŒ
  Pacote 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Bloqueado ğŸ”’ (aguarda Pacote 2)
  Pacote 4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Bloqueado ğŸ”’ (aguarda Pacote 2)

  [RetransmissÃ£o de Pacote 2]
  Pacote 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Re-entregue âœ…
  Pacote 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Agora liberado âœ…
  Pacote 4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Agora liberado âœ…

  LatÃªncia adicional: ~1 RTT (Round-Trip Time)


FIFO (First In, First Out):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  state_queue = [Estado1, Estado2, Estado3]

  Processamento:
  1. state = queue.pop(0)  â† Pega Estado1
  2. state = queue.pop(0)  â† Pega Estado2
  3. state = queue.pop(0)  â† Pega Estado3

  [Garante ordem temporal correta]
```

---

**Documento criado por:** JoÃ£o Costa  
**InstituiÃ§Ã£o:** UESC  
**VersÃ£o:** 1.0  
**Data:** Dezembro de 2024
